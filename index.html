<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Document Manager - Yash Enterprises</title>

<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 10px; background: #f7f7f7; }
  h1 { text-align: center; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input[type=text], input[type=number], textarea, select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
  textarea { height: 100px; resize: vertical; }
  button { margin: 10px 5px 10px 0; padding: 8px 15px; cursor: pointer; }
  .doc-list { margin-top: 20px; }
  .doc-item { background: white; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
  .doc-item:hover { background: #e6f7ff; }
  .hidden { display: none; }
  .image-preview { max-height: 150px; margin-top: 5px; border-radius: 5px; }
  .lang-switcher { float: right; margin-top: -40px; }
  .error { color: red; font-weight: bold; }
  .success { color: green; font-weight: bold; }
  .share-buttons button { margin-right: 5px; }
  .footer { margin-top: 40px; font-size: 0.9em; color: #666; text-align: center; }
</style>

</head>
<body>

<h1>Document Manager - Yash Enterprises</h1>

<div class="lang-switcher">
  <label for="languageSelect">Language:</label>
  <select id="languageSelect" aria-label="Language selector">
    <option value="en">English</option>
    <option value="hi">हिंदी (Hindi)</option>
    <option value="mr">मराठी (Marathi)</option>
  </select>
</div>

<div id="messages"></div>

<form id="docForm">
  <label for="titleInput" id="labelTitle">Title</label>
  <input type="text" id="titleInput" name="title" required minlength="1" maxlength="100" />

  <label for="contentInput" id="labelContent">Content</label>
  <textarea id="contentInput" name="content" required minlength="1" maxlength="5000"></textarea>

  <label for="rateInput" id="labelRate">Rate (₹)</label>
  <input type="number" id="rateInput" name="rate" min="0" step="0.01" required />

  <label for="contactInput" id="labelContact">Contact Number</label>
  <input type="text" id="contactInput" name="contact" pattern="\d{10}" maxlength="10" placeholder="10 digit number" required />

  <label for="imageInput" id="labelImage">Upload Image</label>
  <input type="file" id="imageInput" name="image" accept="image/*" />
  <img id="imagePreview" class="image-preview hidden" alt="Image Preview" />

  <label for="termsCheckbox" id="labelTerms">
    <input type="checkbox" id="termsCheckbox" required /> I accept the <a href="#" target="_blank" id="termsLink">Terms and Conditions</a>
  </label>

  <button type="submit" id="submitBtn">Create Document</button>
  <button type="button" id="updateBtn" class="hidden">Update Document</button>
  <button type="button" id="cancelEditBtn" class="hidden">Cancel Edit</button>
</form>

<div class="doc-list" id="docList">
  <h2 id="labelDocsList">Documents</h2>
  <!-- Document items will appear here -->
</div>

<div class="share-buttons" id="shareButtons" class="hidden">
  <h3 id="labelShare">Share Document:</h3>
  <button id="copyLinkBtn">Copy Link</button>
  <button id="emailShareBtn">Email</button>
  <button id="whatsappShareBtn">WhatsApp</button>
  <button id="facebookShareBtn">Facebook</button>
  <button id="twitterShareBtn">Twitter</button>
</div>

<div style="margin-top:30px;">
  <button id="exportJsonBtn">Export JSON</button>
  <button id="exportCsvBtn">Export CSV</button>
  <button id="exportPdfBtn">Export PDF</button>
  <button id="exportWordBtn">Export Word (.docx)</button>
</div>

<div class="footer">
  &copy; 2025 Yash Enterprises. All rights reserved.
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.2.1/docx.min.js"></script>

<script>
(() => {
  "use strict";

  // Constants & Variables
  const LANGUAGES = {
    en: {
      title: "Title",
      content: "Content",
      rate: "Rate (₹)",
      contact: "Contact Number",
      contactPlaceholder: "10 digit number",
      uploadImage: "Upload Image",
      acceptTerms: "I accept the Terms and Conditions",
      termsLink: "terms-and-conditions.html",
      createDoc: "Create Document",
      updateDoc: "Update Document",
      cancelEdit: "Cancel Edit",
      documentsList: "Documents",
      shareDocument: "Share Document:",
      copyLink: "Copy Link",
      emailShare: "Email",
      whatsappShare: "WhatsApp",
      facebookShare: "Facebook",
      twitterShare: "Twitter",
      exportJson: "Export JSON",
      exportCsv: "Export CSV",
      exportPdf: "Export PDF",
      exportWord: "Export Word (.docx)",
      validationContactLength: "Contact number must be exactly 10 digits.",
      validationTerms: "You must accept the terms and conditions.",
      successCreate: "Document created successfully!",
      successUpdate: "Document updated successfully!",
      errorNoDocSelected: "No document selected to update.",
      errorAdminOnlyEdit: "Editing time expired. Only admin can edit this document.",
    },
    hi: {
      title: "शीर्षक",
      content: "सामग्री",
      rate: "दर (₹)",
      contact: "संपर्क नंबर",
      contactPlaceholder: "10 अंकों का नंबर",
      uploadImage: "छवि अपलोड करें",
      acceptTerms: "मैं नियम और शर्तें स्वीकार करता हूँ",
      termsLink: "terms-and-conditions.html",
      createDoc: "दस्तावेज़ बनाएँ",
      updateDoc: "दस्तावेज़ अपडेट करें",
      cancelEdit: "संपादन रद्द करें",
      documentsList: "दस्तावेज़",
      shareDocument: "दस्तावेज़ साझा करें:",
      copyLink: "लिंक कॉपी करें",
      emailShare: "ईमेल",
      whatsappShare: "व्हाट्सएप",
      facebookShare: "फेसबुक",
      twitterShare: "ट्विटर",
      exportJson: "JSON निर्यात करें",
      exportCsv: "CSV निर्यात करें",
      exportPdf: "PDF निर्यात करें",
      exportWord: "Word (.docx) निर्यात करें",
      validationContactLength: "संपर्क नंबर ठीक 10 अंकों का होना चाहिए।",
      validationTerms: "आपको नियम और शर्तें स्वीकार करनी होंगी।",
      successCreate: "दस्तावेज़ सफलतापूर्वक बनाया गया!",
      successUpdate: "दस्तावेज़ सफलतापूर्वक अपडेट किया गया!",
      errorNoDocSelected: "अपडेट करने के लिए कोई दस्तावेज़ चयनित नहीं है।",
      errorAdminOnlyEdit: "संपादन का समय समाप्त हो गया। केवल व्यवस्थापक इसे संपादित कर सकता है।",
    },
    mr: {
      title: "शीर्षक",
      content: "सामग्री",
      rate: "दर (₹)",
      contact: "संपर्क क्रमांक",
      contactPlaceholder: "१० अंकी क्रमांक",
      uploadImage: "प्रतिमा अपलोड करा",
      acceptTerms: "मी अटी व शर्ती स्वीकार करतो",
      termsLink: "terms-and-conditions.html",
      createDoc: "दस्तऐवज तयार करा",
      updateDoc: "दस्तऐवज अपडेट करा",
      cancelEdit: "संपादन रद्द करा",
      documentsList: "दस्तऐवज",
      shareDocument: "दस्तऐवज शेअर करा:",
      copyLink: "दुवा कॉपी करा",
      emailShare: "ईमेल",
      whatsappShare: "व्हाट्सअॅप",
      facebookShare: "फेसबुक",
      twitterShare: "ट्विटर",
      exportJson: "JSON निर्यात करा",
      exportCsv: "CSV निर्यात करा",
      exportPdf: "PDF निर्यात करा",
      exportWord: "Word (.docx) निर्यात करा",
      validationContactLength: "संपर्क क्रमांक बरोबर १० अंकांचा असावा.",
      validationTerms: "आपल्याला अटी व शर्ती स्वीकाराव्या लागतील.",
      successCreate: "दस्तऐवज यशस्वीरीत्या तयार झाले!",
      successUpdate: "दस्तऐवज यशस्वीरीत्या अपडेट झाले!",
      errorNoDocSelected: "अपडेट करण्यासाठी दस्तऐवज निवडलेला नाही.",
      errorAdminOnlyEdit: "संपादनाचा वेळ संपला. फक्त प्रशासक दस्तऐवज संपादित करू शकतो.",
    }
  };

  // Admin emails (can be replaced by config or Google Sheets later)
  const ADMIN_EMAILS = ["admin@yashenterprises.com"];

  // Global variables
  let currentLang = "en";
  let docs = [];
  let editDocId = null;
  let isAdmin = false; // This would be determined by actual authentication in real app

  // DOM elements
  const titleInput = document.getElementById("titleInput");
  const contentInput = document.getElementById("contentInput");
  const rateInput = document.getElementById("rateInput");
  const contactInput = document.getElementById("contactInput");
  const imageInput = document.getElementById("imageInput");
  const imagePreview = document.getElementById("imagePreview");
  const docForm = document.getElementById("docForm");
  const docList = document.getElementById("docList");
  const submitBtn = document.getElementById("submitBtn");
  const updateBtn = document.getElementById("updateBtn");
  const cancelEditBtn = document.getElementById("cancelEditBtn");
  const messagesDiv = document.getElementById("messages");
  const langSelect = document.getElementById("languageSelect");
  const termsCheckbox = document.getElementById("termsCheckbox");
  const termsLink = document.getElementById("termsLink");

  // Share buttons
  const shareButtonsDiv = document.getElementById("shareButtons");
  const copyLinkBtn = document.getElementById("copyLinkBtn");
  const emailShareBtn = document.getElementById("emailShareBtn");
  const whatsappShareBtn = document.getElementById("whatsappShareBtn");
  const facebookShareBtn = document.getElementById("facebookShareBtn");
  const twitterShareBtn = document.getElementById("twitterShareBtn");

  // Export buttons
  const exportJsonBtn = document.getElementById("exportJsonBtn");
  const exportCsvBtn = document.getElementById("exportCsvBtn");
  const exportPdfBtn = document.getElementById("exportPdfBtn");
  const exportWordBtn = document.getElementById("exportWordBtn");

  // UTILITIES

  // Show message (success or error)
  function showMessage(text, isError = false) {
    messagesDiv.innerText = text;
    messagesDiv.className = isError ? "error" : "success";
    setTimeout(() => {
      messagesDiv.innerText = "";
      messagesDiv.className = "";
    }, 4000);
  }

  // Format date to ISO string
  function isoNow() {
    return new Date().toISOString();
  }

  // Load from localStorage
  function loadDocs() {
    const saved = localStorage.getItem("documents");
    if (saved) {
      docs = JSON.parse(saved);
    }
  }

  // Save to localStorage
  function saveDocs() {
    localStorage.setItem("documents", JSON.stringify(docs));
  }

  // Get document by ID
  function getDocById(id) {
    return docs.find(d => d.id === id);
  }

  // Clear form
  function clearForm() {
    docForm.reset();
    imagePreview.src = "";
    imagePreview.classList.add("hidden");
    editDocId = null;
    submitBtn.classList.remove("hidden");
    updateBtn.classList.add("hidden");
    cancelEditBtn.classList.add("hidden");
  }

  // Fill form for editing
  function fillForm(doc) {
    titleInput.value = doc.title;
    contentInput.value = doc.content;
    rateInput.value = doc.rate;
    contactInput.value = doc.contact;
    termsCheckbox.checked = true;
    if (doc.imageData) {
      imagePreview.src = doc.imageData;
      imagePreview.classList.remove("hidden");
    } else {
      imagePreview.src = "";
      imagePreview.classList.add("hidden");
    }
    editDocId = doc.id;
    submitBtn.classList.add("hidden");
    updateBtn.classList.remove("hidden");
    cancelEditBtn.classList.remove("hidden");
  }

  // Validate contact number length
  function validateContactNumber(number) {
    return /^\d{10}$/.test(number);
  }

  // Check if user can edit document (within 24 hours or admin)
  function canUserEdit(doc) {
    if (isAdmin) return true;
    const createdTime = new Date(doc.createdAt).getTime();
    const now = Date.now();
    return now - createdTime <= 24 * 3600 * 1000; // 24 hours in ms
  }

  // Render document list
  function renderDocs() {
    docList.innerHTML = `<h2>${LANGUAGES[currentLang].documentsList}</h2>`;
    if (docs.length === 0) {
      docList.innerHTML += `<p>No documents created yet.</p>`;
      return;
    }
    docs.forEach(doc => {
      const canEdit = canUserEdit(doc);
      const docDiv = document.createElement("div");
      docDiv.className = "doc-item";
      docDiv.innerHTML = `
        <strong>${doc.title}</strong> (₹${doc.rate})<br/>
        <em>Contact: ${doc.contact}</em><br/>
        <small>Created: ${new Date(doc.createdAt).toLocaleString()}</small><br/>
        ${doc.imageData ? `<img src="${doc.imageData}" alt="Doc Image" style="max-height:100px; margin-top:5px; border-radius:5px;" />` : ""}
        <p>${doc.content}</p>
        <button class="edit-btn" data-id="${doc.id}" ${canEdit ? "" : "disabled"}>${canEdit ? "Edit" : "Edit (Admin only)"}</button>
        <button class="delete-btn" data-id="${doc.id}" ${isAdmin ? "" : "disabled"}>Delete</button>
      `;
      docList.appendChild(docDiv);
    });
  }

  // Handle image preview on file select
  imageInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) {
      imagePreview.src = "";
      imagePreview.classList.add("hidden");
      return;
    }
    const reader = new FileReader();
    reader.onload = () => {
      imagePreview.src = reader.result;
      imagePreview.classList.remove("hidden");
    };
    reader.readAsDataURL(file);
  });

  // Form submit - create document
  docForm.addEventListener("submit", e => {
    e.preventDefault();

    // Validate contact length
    if (!validateContactNumber(contactInput.value)) {
      showMessage(LANGUAGES[currentLang].validationContactLength, true);
      return;
    }

    if (!termsCheckbox.checked) {
      showMessage(LANGUAGES[currentLang].validationTerms, true);
      return;
    }

    if (editDocId) {
      showMessage(LANGUAGES[currentLang].errorNoDocSelected, true);
      return;
    }

    // Create document object
    const newDoc = {
      id: "doc_" + Date.now(),
      title: titleInput.value.trim(),
      content: contentInput.value.trim(),
      rate: parseFloat(rateInput.value),
      contact: contactInput.value.trim(),
      imageData: imagePreview.src || "",
      createdAt: isoNow(),
      updatedAt: isoNow()
    };
    docs.push(newDoc);
    saveDocs();
    renderDocs();
    clearForm();
    showMessage(LANGUAGES[currentLang].successCreate);
  });

  // Update document button
  updateBtn.addEventListener("click", () => {
    if (!editDocId) {
      showMessage(LANGUAGES[currentLang].errorNoDocSelected, true);
      return;
    }

    const doc = getDocById(editDocId);
    if (!doc) {
      showMessage(LANGUAGES[currentLang].errorNoDocSelected, true);
      return;
    }

    if (!canUserEdit(doc)) {
      showMessage(LANGUAGES[currentLang].errorAdminOnlyEdit, true);
      return;
    }

    if (!validateContactNumber(contactInput.value)) {
      showMessage(LANGUAGES[currentLang].validationContactLength, true);
      return;
    }

    if (!termsCheckbox.checked) {
      showMessage(LANGUAGES[currentLang].validationTerms, true);
      return;
    }

    // Update document properties
    doc.title = titleInput.value.trim();
    doc.content = contentInput.value.trim();
    doc.rate = parseFloat(rateInput.value);
    doc.contact = contactInput.value.trim();
    doc.imageData = imagePreview.src || "";
    doc.updatedAt = isoNow();

    saveDocs();
    renderDocs();
    clearForm();
    showMessage(LANGUAGES[currentLang].successUpdate);
  });

  // Cancel edit button
  cancelEditBtn.addEventListener("click", () => {
    clearForm();
  });

  // Delegate edit and delete buttons on document list
  docList.addEventListener("click", e => {
    if (e.target.classList.contains("edit-btn")) {
      const id = e.target.dataset.id;
      const doc = getDocById(id);
      if (!doc) return;
      if (!canUserEdit(doc)) {
        showMessage(LANGUAGES[currentLang].errorAdminOnlyEdit, true);
        return;
      }
      fillForm(doc);
    } else if (e.target.classList.contains("delete-btn")) {
      if (!isAdmin) {
        alert("Only admin can delete documents.");
        return;
      }
      const id = e.target.dataset.id;
      if (!confirm("Are you sure you want to delete this document?")) return;
      docs = docs.filter(d => d.id !== id);
      saveDocs();
      renderDocs();
      clearForm();
    }
  });

  // Language switcher
  langSelect.addEventListener("change", () => {
    currentLang = langSelect.value;
    translateUI();
    renderDocs();
  });

  // Translate UI text based on language
  function translateUI() {
    const L = LANGUAGES[currentLang];
    document.getElementById("labelTitle").innerText = L.title;
    document.getElementById("labelContent").innerText = L.content;
    document.getElementById("labelRate").innerText = L.rate;
    document.getElementById("labelContact").innerText = L.contact;
    contactInput.placeholder = L.contactPlaceholder;
    document.getElementById("labelImage").innerText = L.uploadImage;
    document.getElementById("labelTerms").innerHTML = `<input type="checkbox" id="termsCheckbox" required /> ${L.acceptTerms} <a href="${L.termsLink}" target="_blank">${L.acceptTerms}</a>`;
    termsCheckbox.checked = false;
    submitBtn.innerText = L.createDoc;
    updateBtn.innerText = L.updateDoc;
    cancelEditBtn.innerText = L.cancelEdit;
    document.getElementById("labelDocsList").innerText = L.documentsList;
    document.getElementById("labelShare").innerText = L.shareDocument;
    copyLinkBtn.innerText = L.copyLink;
    emailShareBtn.innerText = L.emailShare;
    whatsappShareBtn.innerText = L.whatsappShare;
    facebookShareBtn.innerText = L.facebookShare;
    twitterShareBtn.innerText = L.twitterShare;
    exportJsonBtn.innerText = L.exportJson;
    exportCsvBtn.innerText = L.exportCsv;
    exportPdfBtn.innerText = L.exportPdf;
    exportWordBtn.innerText = L.exportWord;
  }

  // Export functions
  function exportJSON() {
    const dataStr = JSON.stringify(docs, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    saveAs(blob, "documents.json");
  }

  function exportCSV() {
    if (docs.length === 0) {
      alert("No documents to export.");
      return;
    }
    const header = ["ID", "Title", "Content", "Rate", "Contact", "Created At", "Updated At"];
    const rows = docs.map(d => [
      `"${d.id}"`,
      `"${d.title.replace(/"/g, '""')}"`,
      `"${d.content.replace(/"/g, '""')}"`,
      d.rate,
      d.contact,
      d.createdAt,
      d.updatedAt
    ]);
    const csvContent = [header, ...rows].map(e => e.join(",")).join("\n");
    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
    saveAs(blob, "documents.csv");
  }

  function exportPDF() {
    if (docs.length === 0) {
      alert("No documents to export.");
      return;
    }
    const dd = {
      content: []
    };
    docs.forEach(doc => {
      dd.content.push({ text: doc.title, style: "header" });
      dd.content.push({ text: `Rate: ₹${doc.rate}`, style: "subheader" });
      dd.content.push({ text: `Contact: ${doc.contact}` });
      dd.content.push({ text: `Created: ${new Date(doc.createdAt).toLocaleString()}` });
      dd.content.push({ text: doc.content });
      dd.content.push({ text: "\n" });
    });
    pdfMake.createPdf(dd).download("documents.pdf");
  }

  async function exportWord() {
    if (docs.length === 0) {
      alert("No documents to export.");
      return;
    }
    const { Document, Packer, Paragraph, TextRun } = docx;

    const doc = new Document();
    docs.forEach(d => {
      doc.addSection({
        children: [
          new Paragraph({
            children: [new TextRun({ text: d.title, bold: true, size: 28 })],
          }),
          new Paragraph({ text: `Rate: ₹${d.rate}` }),
          new Paragraph({ text: `Contact: ${d.contact}` }),
          new Paragraph({ text: `Created: ${new Date(d.createdAt).toLocaleString()}` }),
          new Paragraph({ text: d.content }),
          new Paragraph({ text: "" }),
        ],
      });
    });

    const blob = await Packer.toBlob(doc);
    saveAs(blob, "documents.docx");
  }

  // Share buttons
  function getCurrentDocLink(docId) {
    return `${window.location.href}#doc=${docId}`;
  }

  copyLinkBtn.addEventListener("click", () => {
    if (!editDocId) {
      alert("Select a document to share.");
      return;
    }
    const link = getCurrentDocLink(editDocId);
    navigator.clipboard.writeText(link)
      .then(() => alert("Link copied to clipboard!"))
      .catch(() => alert("Failed to copy link."));
  });

  emailShareBtn.addEventListener("click", () => {
    if (!editDocId) {
      alert("Select a document to share.");
      return;
    }
    const doc = getDocById(editDocId);
    const subject = encodeURIComponent(`Document: ${doc.title}`);
    const body = encodeURIComponent(`Check out this document:\n\n${doc.title}\n\n${doc.content}\n\nContact: ${doc.contact}`);
    window.open(`mailto:?subject=${subject}&body=${body}`, "_blank");
  });

  whatsappShareBtn.addEventListener("click", () => {
    if (!editDocId) {
      alert("Select a document to share.");
      return;
    }
    const doc = getDocById(editDocId);
    const text = encodeURIComponent(`Check out this document:\n\n${doc.title}\n\n${doc.content}\n\nContact: ${doc.contact}`);
    window.open(`https://wa.me/?text=${text}`, "_blank");
  });

  facebookShareBtn.addEventListener("click", () => {
    if (!editDocId) {
      alert("Select a document to share.");
      return;
    }
    const link = getCurrentDocLink(editDocId);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}`, "_blank");
  });

  twitterShareBtn.addEventListener("click", () => {
    if (!editDocId) {
      alert("Select a document to share.");
      return;
    }
    const doc = getDocById(editDocId);
    const text = encodeURIComponent(`Check out this document: ${doc.title}`);
    const link = getCurrentDocLink(editDocId);
    window.open(`https://twitter.com/intent/tweet?text=${text}&url=${encodeURIComponent(link)}`, "_blank");
  });

  // On load initialization
  function init() {
    // Simulated admin login prompt
    const adminEmail = prompt("Enter your email to check admin access (leave blank for user):");
    if (adminEmail && ADMIN_EMAILS.includes(adminEmail.toLowerCase())) {
      isAdmin = true;
      alert("Admin access granted.");
    } else {
      isAdmin = false;
    }

    loadDocs();
    translateUI();
    renderDocs();

    // Show/hide share buttons depending on selection
    shareButtonsDiv.style.display = "block";
  }

  // Run init
  window.addEventListener("load", init);

})();
</script>

</body>
</html>
